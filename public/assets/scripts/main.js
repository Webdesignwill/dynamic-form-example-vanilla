"use strict";var _createClass=function(){function n(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,s){return t&&n(e.prototype,t),s&&n(e,s),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Application=function(){function e(){var t=this;_classCallCheck(this,e),this.state={brands:{},models:{},selected:{brand:null,model:null,keywords:null}},this.$broker=$({}),this.components={},document.querySelectorAll('[data-component="form-control"]').forEach(function(e){t.components[e.name]=e}),this.request("brands").done(function(){return t.populate("brands")}),this.$broker.on("selected:brand",function(e){t.request("models").done(function(){return t.populate("models")})}),this.$broker.on("reset:models",function(){return t.resetModels("models")}),this.attachElementListeners(),this.validator()}return _createClass(e,[{key:"brands",get:function(){return this.state.brands},set:function(e){this.state.brands=e}},{key:"models",get:function(){return this.state.models},set:function(e){this.state.models=e}},{key:"selectedbrands",get:function(){return this.state.selected.brand},set:function(e){0==e?(this.state.selected.brand=null,this.state.selected.model=null,this.$broker.trigger("reset:models")):e!==this.state.selected.brand&&0!=e&&(this.state.selected.brand=e,this.$broker.trigger("selected:brand"))}},{key:"selectedmodels",get:function(){return this.state.selected.model},set:function(e){0==e?(this.state.selected.model=null,this.$broker.trigger("reset:keywords")):(this.state.selected.model=e,this.$broker.trigger("selected:model"))}},{key:"selectedkeywords",get:function(){return this.state.selected.keywords},set:function(e){e.length?(this.state.selected.keywords=e,this.$broker.trigger("selected:keywords")):(this.state.selected.keywords=null,this.$broker.trigger("reset:submit"))}}]),_createClass(e,[{key:"validator",value:function(){var t=this;this.$broker.on("selected:brand selected:model selected:keywords reset:models reset:keywords reset:submit",function(e){t.selectedbrands?(t.enable("submit"),t.enable("models")):t.selectedkeywords?t.enable("submit"):(t.disable("submit"),t.disable("models"))})}},{key:"enable",value:function(e){this.components[e].removeAttribute("disabled"),this.components[e].classList.remove("disabled")}},{key:"disable",value:function(e){this.components[e].setAttribute("disabled","disabled"),this.components[e].classList.add("disabled")}},{key:"attachElementListeners",value:function(){function e(t){var s=n.components[t];$(s).on("change",function(e){if("text"!==e.target.type)return n["selected"+t]=s.options[s.selectedIndex].value;n.selectedkeywords=e.target.value})}var n=this;for(var t in this.components)e(t)}},{key:"request",value:function(t){var s=this,n=$.Deferred(),e="/api/cars/"+t;return this.selectedbrands&&(e=e+"?brand_id="+this.selectedbrands),$.get(e).done(function(e){s[t]=e,n.resolve(e)}),n}},{key:"resetModels",value:function(e){this.components[e].options.length=0;var t=document.createElement("option");t.setAttribute("value",0),t.text="-- All "+e+" --",this.components[e].add(t)}},{key:"populate",value:function(s){var n=this;this.selectedbrands&&this.resetModels(s),this[s].forEach(function(e){var t=document.createElement("option");t.setAttribute("value",e._id),t.text=e.text,n.components[s].add(t)})}}]),e}();document.addEventListener("DOMContentLoaded",function(){document.querySelector('[data-component="application"]')&&new Application});